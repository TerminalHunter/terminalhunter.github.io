<!DOCTYPE html>
<html> 
<head> 
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0px; padding: 0px }
      #map_canvas { height: 100%; z-index: 0;}
      #gmnoprint {width: auto;}
</style>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/> 
<title>Initiative Gaming Archeage Map</title> 
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

<script>
// Arrays for markers and info boxen

var markerInfoArray = [];
var markerArray = [];
var infoBoxen = [];

var currX = 0;
var currY = 0;

//--- PREPARE THE XML! ---

if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.open("GET","markers.xml",false);
xmlhttp.send();
xmlDoc=xmlhttp.responseXML;

var xmlMarkers = xmlDoc.getElementsByTagName("marker");

// --- PUT SHIT IN OBJECTS TO USE LATER! ---

for(i=0;i<xmlMarkers.length;i++){
	var newMarker = {
		title:xmlDoc.getElementsByTagName("title")[i].childNodes[0].nodeValue,
		info:xmlDoc.getElementsByTagName("info")[i].childNodes[0].nodeValue,
		icon:xmlDoc.getElementsByTagName("icon")[i].childNodes[0].nodeValue,
		category:xmlDoc.getElementsByTagName("category")[i].childNodes[0].nodeValue,
		x:xmlDoc.getElementsByTagName("x")[i].childNodes[0].nodeValue,
		y:xmlDoc.getElementsByTagName("y")[i].childNodes[0].nodeValue
	};
	
	markerInfoArray.push(newMarker);
}

</script>

<script>
// --- MAP SCRIPT ---
function CustomMapType() {
}
CustomMapType.prototype.tileSize = new google.maps.Size(256,256);
CustomMapType.prototype.maxZoom = 7;
CustomMapType.prototype.getTile = function(coord, zoom, ownerDocument) {
    var div = ownerDocument.createElement('DIV');
	var baseURL = 'http://terminalhunter.github.io/Initiative/map/';
    baseURL += zoom + '_' + coord.x + '_' + coord.y + '.png';
    div.style.width = this.tileSize.width + 'px';
    div.style.height = this.tileSize.height + 'px';
    div.style.backgroundColor = '#C9B873';
    div.style.backgroundImage = 'url(' + baseURL + ')';
    return div;
};

CustomMapType.prototype.name = "Custom";
CustomMapType.prototype.alt = "Tile Coordinate Map Type";
var map;
var CustomMapType = new CustomMapType();

// --- MAP INIT ---

function initialize() {
  var mapOptions = {
      minZoom: 2,
    maxZoom: 7,
    isPng: true,
      mapTypeControl: false,
      streetViewControl: false,
        center: new google.maps.LatLng(23.795397597978745,-76.728515625),
      zoom: 5,
    mapTypeControlOptions: {
      mapTypeIds: ['custom', google.maps.MapTypeId.ROADMAP],
      style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
    }
  };
map = new google.maps.Map(document.getElementById("map_canvas"),mapOptions);
map.mapTypes.set('custom',CustomMapType);
map.setMapTypeId('custom');

// --- TAKE THE STUFF FROM XML AND MAKE MARKERS

for(var i = 0;i<markerInfoArray.length;i++){
	
	var temp = new google.maps.Marker({
		position: new google.maps.LatLng(markerInfoArray[i].x,markerInfoArray[i].y),
		map: map,
		title: markerInfoArray[i].title,
		icon: markerInfoArray[i].icon,
		// This is extra info to put in boxes to be passed onto the addInfoWindow() below
		info: markerInfoArray[i].info,
		//Add some categorical data
		category: markerInfoArray[i].category
	});
	
	addInfoWindow(temp, markerInfoArray[i].info);
	
	markerArray.push(temp);
	
}

// --- MAKE INFOBOXES APPEAR WHEN CLICKING MARKERS ---

var infowindow = new google.maps.InfoWindow({
	content: "Well<br>What<br>If",
	maxWidth: 200
});

function addInfoWindow(marker, information){
	google.maps.event.addListener(marker, 'click', function(){
		if(infowindow.getMap())
			infowindow.close();
		infowindow.setContent(information);
		infowindow.open(map,marker);
	});
}

// --- CLICK THE MAP TO GET SOME COORDS, FIGURE OUT HOW TO INTO SEXTANT ---

google.maps.event.addListener(map, 'click', function(e){
	console.log(e.latLng.toString());
	currX = e.latLng.lat();
	currY = e.latLng.lng();
	updateXY();
});

}

</script>

</head> 


<body onload="initialize()"> 

<!--
<div id="bork" style="color:white;">Map is mostly under construction and may not work at any given time...<br>If you're reading this, go yell at Terminal because he broke something.
Unless you're reading the source, you cheeky bugger.
</div>
-->

<div id="categories" style="color:white;">

<form>
<!-- This is a test case and needs to be replaced by js that dynamically creates categories based on the xml
something like: 
var x = document.createElement("INPUT");
x.setAttribute("type","checkbox");
x.setAttribute("name","categories");
x.setAttribute("value","whatever the xml says");

it should also look nicer.
-->


Categories:<br>
<input type="checkbox" name="categories" value="land" id="cat1" onclick="categoryUpdate('Guild Land','cat1',markerArray)" checked=true>Guild Land<br>
<input type="checkbox" name="categories" value="mines" id="cat2" onclick="categoryUpdate('Mining','cat2',markerArray)" checked=true>Mining<br>
<hr>
</form>

<script>
function categoryUpdate(cat,id,markers){
	for(var i = 0; i<markers.length;i++){
		if(markers[i].category == cat){
			if(document.getElementById(id).checked){
				markers[i].setMap(map);
			}else{
				markers[i].setMap(null);
			}
		}
	}
}

</script>

</div>

<div id="addMarkerUI" style="color:white;">

x: <input type="text" name="xBox" value="" id="x">
y: <input type="text" name="yBox" value="" id="y">
<!--<br>
Name: <input type="text" name="nameBox" value="" id="name">
<br>
Icon:
<select>
	<option value="ex">Exclamation Point</option>
	<option value="plant">Plant</option>
	<option value="pick">Pickaxe</option>
</select>
<br>
Description: <input type="text" name="descBox" value="" id="desc">
<br>
Category: <input type="text" name="catBox" value="" id="cat">
<br>
<input type="submit" onclick="submitNewMarker()">

-->

<script>
function updateXY(){

	document.getElementById("x").value = currX;
	document.getElementById("y").value = currY;

}

function submitNewMarker(){
	
}
</script>

</div>

<!-- Add "is your name Narwhal?" question, don't allow yes answers to post markers -->

<div id="map_canvas" style="background: #1B2D33;"></div> 
</body>
</html> 